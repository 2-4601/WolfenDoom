//mxd. Stealth-related stuff. Must be loaded after nazis.txt. Contains frightening ammount of hacks...

//////////////
//BASE STUFF//
//////////////
// Not defined for GZDB
ACTOR AlertMarker
{
	Scale 2.0
	+BRIGHT
	+NOGRAVITY
	States
	{
		Spawn:
			EXCL C 1 NoDelay A_PlaySound("misc/alert", CHAN_BODY)
			Goto Fade
		Fade:
			EXCL C 0 A_Warp(AAPTR_MASTER, 0, 0, 64)
			EXCL C 1 A_FadeOut(0.01)
			Loop
	}
}

///////////
//ENEMIES//
///////////

ACTOR SneakableSSMP40Guard : SSMP40Guard
{
	//$Category Monsters (Wolf3D)/Sneak-Friendly
	//$Title SS Guard (MP40, sneak-friendly)
	//$Color 4
	//$Sprite SSMGA1
	PainChance 256							// Otherwise our Pain states won't always work...
	DropItem "9mmAmmo" 192
	DropItem "GrenadePickup" 16
	DropItem "MP40" 64
	var int user_chasegoal;			// Current PatrolTarget TID is stored here when the guard becomes alerted
	var int user_stealthkilled;	// Hackity hacks...
	var int user_attacked;
	+FRIENDLY										// The guy is friendly. Looks like walking the patrol without immediately aquiring the player as a targer won't work otherwise...
	+NEVERTARGET								// Prevents +FRIENDLY guards from attacking -FRIENDLY guards
	+NOINFIGHTING								// Prevents guards from attacking other guards with same FRIENDLY flag settings
	States
	{
		Spawn:
			TNT1 A 0 NoDelay A_SpawnItemEx("SneakableGuardEyesIdle", 0, 0, 0, 0, 0, 0, 0, SXF_SETMASTER | SXF_NOCHECKPOSITION)
			Goto Super::Spawn
		Missile:
			"####" "#" 0 A_AlertMonsters(512) // Something fishy is definitely going on!
			Goto Super::Missile
		Pain: 
			"####" "#" 0 A_CheckFlag("FRIENDLY", "BecomeAlerted") // Stop being so friendly when damaged (if not already alerted)
			Goto Super::Pain
		Pain.SilentKnifeAttack: // Done using PainType "SilentKnifeAttack" on KnifePuff because I need this to REPLACE Pain state, not be called AFTER it
			"####" "#" 0 A_CheckFlag("FRIENDLY", "StealthKill") // Only unalerted enemies can be stealth-killed
			Goto Super::Pain
		StealthKill:
			"####" "#" 0 A_Log("Stealth kill!")
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING) // Despawn children
			"####" "#" 1 A_AlertMonsters(128) 
			"####" "#" 0 ACS_NamedExecuteAlways("AddExtraVisibility", 0, 200, 1) //...And make the player super-visible
			"####" "#" 0 A_SetUserVar("user_stealthkilled", TRUE)
			"####" "#" 0 A_Die
			Stop
		BecomeAlerted: // Become alerted after being attacked
			"####" "#" 0 A_SetUserVar("user_attacked", 1)
			"####" "#" 0 A_PlaySound("axis1/sighted", CHAN_BODY)
		Pain.BecomeAlerted: // Stop being friendly without visual effects when poked by PatrollingGuardEyes
			"####" "#" 0 A_SetUserVar("user_chasegoal", CallACS("GetChaseGoal", user_chasegoal)) // Store current chase goal, if any
			"####" "#" 0 A_ChangeFlag("FRIENDLY", FALSE)
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING) // Despawn children
			"####" "#" 0 A_AlertMonsters(512) // Something fishy is going on. Alert everybody around!
			"####" "#" 0 A_SpawnItemEx("SneakableGuardEyesAlerted", 0, 0, 0, 0, 0, 0, 0, SXF_SETMASTER | SXF_NOCHECKPOSITION)
			"####" "#" 0 A_JumpIf(user_attacked > 0, "Super::Pain")
			"####" "#" 0 A_Jump(256, "See") //So that inheriting actors go to their own See State
			Goto See
		Pain.BecomeIdle: // Become friendly again and resume patrolling, if possible
			"####" "#" 0 A_ChangeFlag("FRIENDLY", TRUE)
			"####" "#" 0 A_SetUserVar("user_attacked", 0)
			"####" "#" 0 A_ClearTarget
			"####" "#" 0 ACS_NamedExecute("TryResumePatrolling") 
			Goto Spawn
		Death:
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING) // Despawn children
			"####" "#" 0 A_CheckFlag("FRIENDLY", "Super::Death") // Don't decrease AlertedCount when friendly
			"####" "#" 0 ACS_NamedExecute("DecreaseAlertedCount")
			Goto Super::Death+1
		XDeath: // Same as Death
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)  // Despawn children
			"####" "#" 0 A_CheckFlag("FRIENDLY", "Super::XDeath") // Don't decrease AlertedCount when friendly
			"####" "#" 0 ACS_NamedExecute("DecreaseAlertedCount")
			Goto Super::XDeath
	}
}

ACTOR SneakableSSMP40GuardStatic : SneakableSSMP40Guard
{
	//$Title SS Guard Static (MP40, sneak-friendly, doesn't move)
	var int user_angle;
	States
	{
		Spawn:
			TNT1 A 0 NoDelay A_SetUserVar("user_angle", angle)
			Goto Super::Spawn
		See:
			"####" N 1 {
				A_SetAngle(user_angle);
				A_Chase("Missile", "Missile", CHF_DONTMOVE | CHF_NODIRECTIONTURN);
			}
			Loop
	}
}

ACTOR MGTurretStealth : Nazi
{
	//$Category Monsters (Wolf3D)/Sneak-Friendly
	//$Title Automatic Turret (stealth, hidden, nokillcount)
	//$Color 4
	Obituary "$SSMPGURD"
	Health 100
	Speed 0
	Radius 2
	Height 32
	PainChance 255
	PainSound "metal/pain"
	Mass 0xFFFFFFF
	-COUNTKILL
	+ALLOWPAIN
	+INVULNERABLE
	+NEVERTARGET
	+NOBLOOD
	+NOGRAVITY
	RenderStyle "None"
	States
	{
		Spawn:
			GTUR A 0
			"####" "#" 0 A_SetUserVar("user_incombat", TRUE) //mxd
			Goto Look
		Look:
			"####" A 10 A_LookEx(0, 0.0, 1024.0, 256.0, 65.0, "See")
			Loop
		See:
			"####" A 1 A_JumpIf(CallACS("TargetIsHidden"), "IgnorePlayer")
			"####" A 0 A_Chase("", "Missile", CHF_DONTMOVE)
			Loop
		IgnorePlayer:
			"####" A 1 A_ClearTarget
			Goto Look
		Missile: //This 'turret' fires and reloads like an MP40 Guard 
			"####" A 5 {
				A_FaceTarget;
				A_PlaySound("nazi/mp40", CHAN_WEAPON);
			}
			"####" B 4 {
				A_SpawnProjectile("EnemySMGTracer",24,4,random(-8,8)); 
				A_GiveInventory("SSMP40GuardCounter", 1);
			}
			"####" A 0 A_JumpIfInventory("SSMP40GuardCounter", 40, "Reload")
			"####" C 2 A_MonsterRefire(10, "See")
			Loop
		Reload:
			"####" A 35 {
				A_PlaySound("mp40/reload", CHAN_WEAPON);
				A_TakeInventory("SSMP40GuardCounter", 4);
			}
			"####" A 0 A_JumpIfInventory("SSMP40GuardCounter", 1, "Reload")
			"####" A 10 A_PlaySound("mp40/reload", CHAN_WEAPON)
			Goto See
		Pain: //Disable for 2 seconds when shot, then go to reload
			"####" C 70
			Goto Reload
	}
}

//Ozy81 - New Variants
ACTOR SneakableSSGuard : SSGuard
{
	//$Category Monsters (Wolf3D)/Sneak-Friendly
	//$Title SS Guard (Pistol, sneak-friendly)
	//$Color 4
	//$Sprite SSPGA1
	PainChance 256
	var int user_chasegoal;
	var int user_stealthkilled;
	var int user_attacked;
	+FRIENDLY
	+NEVERTARGET
	+NOINFIGHTING
	States
	{
		Spawn:
			TNT1 A 0 NoDelay A_SpawnItemEx("SneakableGuardEyesIdle", 0, 0, 0, 0, 0, 0, 0, SXF_SETMASTER | SXF_NOCHECKPOSITION)
			Goto Super::Spawn
		Missile:
			"####" "#" 0 A_AlertMonsters(512)
			Goto Super::Missile
		Pain: 
			"####" "#" 0 A_CheckFlag("FRIENDLY", "BecomeAlerted")
			Goto Super::Pain
		Pain.SilentKnifeAttack:
			"####" "#" 0 A_CheckFlag("FRIENDLY", "StealthKill")
			Goto Super::Pain
		StealthKill:
			"####" "#" 0 A_Log("Stealth kill!")
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 1 A_AlertMonsters(128) 
			"####" "#" 0 ACS_NamedExecuteAlways("AddExtraVisibility", 0, 200, 1)
			"####" "#" 0 A_SetUserVar("user_stealthkilled", TRUE)
			"####" "#" 0 A_Die
			Stop
		BecomeAlerted:
			"####" "#" 0 A_SetUserVar("user_attacked", 1)
			"####" "#" 0 A_PlaySound("axis1/sighted", CHAN_BODY)
		Pain.BecomeAlerted:
			"####" "#" 0 A_SetUserVar("user_chasegoal", CallACS("GetChaseGoal", user_chasegoal))
			"####" "#" 0 A_ChangeFlag("FRIENDLY", FALSE)
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 0 A_AlertMonsters(512)
			"####" "#" 0 A_SpawnItemEx("SneakableGuardEyesAlerted", 0, 0, 0, 0, 0, 0, 0, SXF_SETMASTER | SXF_NOCHECKPOSITION)
			"####" "#" 0 A_JumpIf(user_attacked > 0, "Super::Pain")
			"####" "#" 0 A_Jump(256, "See")
			Goto See
		Pain.BecomeIdle:
			"####" "#" 0 A_ChangeFlag("FRIENDLY", TRUE)
			"####" "#" 0 A_SetUserVar("user_attacked", 0)
			"####" "#" 0 A_ClearTarget
			"####" "#" 0 ACS_NamedExecute("TryResumePatrolling") 
			Goto Spawn
		Death:
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 0 A_CheckFlag("FRIENDLY", "Super::Death")
			"####" "#" 0 ACS_NamedExecute("DecreaseAlertedCount")
			Goto Super::Death+1
		XDeath:
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 0 A_CheckFlag("FRIENDLY", "Super::XDeath")
			"####" "#" 0 ACS_NamedExecute("DecreaseAlertedCount")
			Goto Super::XDeath
	}
}

ACTOR SneakableSSOfficer : SSOfficer
{
	//$Category Monsters (Wolf3D)/Sneak-Friendly
	//$Title SS Officer (sneak-friendly)
	//$Color 4
	//$Sprite SSOFA1
	PainChance 256
	var int user_chasegoal;
	var int user_stealthkilled;
	var int user_attacked;
	+FRIENDLY
	+NEVERTARGET
	+NOINFIGHTING
	States
	{
		Spawn:
			TNT1 A 0 NoDelay A_SpawnItemEx("SneakableGuardEyesIdle", 0, 0, 0, 0, 0, 0, 0, SXF_SETMASTER | SXF_NOCHECKPOSITION)
			Goto Super::Spawn
		Missile:
			"####" "#" 0 A_AlertMonsters(512)
			Goto Super::Missile
		Pain: 
			"####" "#" 0 A_CheckFlag("FRIENDLY", "BecomeAlerted")
			Goto Super::Pain
		Pain.SilentKnifeAttack:
			"####" "#" 0 A_CheckFlag("FRIENDLY", "StealthKill")
			Goto Super::Pain
		StealthKill:
			"####" "#" 0 A_Log("Stealth kill!")
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 1 A_AlertMonsters(128) 
			"####" "#" 0 ACS_NamedExecuteAlways("AddExtraVisibility", 0, 200, 1)
			"####" "#" 0 A_SetUserVar("user_stealthkilled", TRUE)
			"####" "#" 0 A_Die
			Stop
		BecomeAlerted:
			"####" "#" 0 A_SetUserVar("user_attacked", 1)
			"####" "#" 0 A_PlaySound("axis1/sighted", CHAN_BODY)
		Pain.BecomeAlerted:
			"####" "#" 0 A_SetUserVar("user_chasegoal", CallACS("GetChaseGoal", user_chasegoal))
			"####" "#" 0 A_ChangeFlag("FRIENDLY", FALSE)
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 0 A_AlertMonsters(512)
			"####" "#" 0 A_SpawnItemEx("SneakableGuardEyesAlerted", 0, 0, 0, 0, 0, 0, 0, SXF_SETMASTER | SXF_NOCHECKPOSITION)
			"####" "#" 0 A_JumpIf(user_attacked > 0, "Super::Pain")
			"####" "#" 0 A_Jump(256, "See")
			Goto See
		Pain.BecomeIdle:
			"####" "#" 0 A_ChangeFlag("FRIENDLY", TRUE)
			"####" "#" 0 A_SetUserVar("user_attacked", 0)
			"####" "#" 0 A_ClearTarget
			"####" "#" 0 ACS_NamedExecute("TryResumePatrolling") 
			Goto Spawn
		Death:
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 0 A_CheckFlag("FRIENDLY", "Super::Death")
			"####" "#" 0 ACS_NamedExecute("DecreaseAlertedCount")
			Goto Super::Death+1
		XDeath:
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 0 A_CheckFlag("FRIENDLY", "Super::XDeath")
			"####" "#" 0 ACS_NamedExecute("DecreaseAlertedCount")
			Goto Super::XDeath
	}
}

ACTOR SneakableWaffenSS : WaffenSS
{
	//$Category Monsters (Wolf3D)/Sneak-Friendly
	//$Title Waffen SS (sneak-friendly)
	//$Color 4
	//$Sprite WAFFA1
	PainChance 256
	var int user_chasegoal;
	var int user_stealthkilled;
	var int user_attacked;
	+FRIENDLY
	+NEVERTARGET
	+NOINFIGHTING
	States
	{
		Spawn:
			TNT1 A 0 NoDelay A_SpawnItemEx("SneakableGuardEyesIdle", 0, 0, 0, 0, 0, 0, 0, SXF_SETMASTER | SXF_NOCHECKPOSITION)
			Goto Super::Spawn
		Missile:
			"####" "#" 0 A_AlertMonsters(512)
			Goto Super::Missile
		Pain: 
			"####" "#" 0 A_CheckFlag("FRIENDLY", "BecomeAlerted")
			Goto Super::Pain
		Pain.SilentKnifeAttack:
			"####" "#" 0 A_CheckFlag("FRIENDLY", "StealthKill")
			Goto Super::Pain
		StealthKill:
			"####" "#" 0 A_Log("Stealth kill!")
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 1 A_AlertMonsters(128) 
			"####" "#" 0 ACS_NamedExecuteAlways("AddExtraVisibility", 0, 200, 1)
			"####" "#" 0 A_SetUserVar("user_stealthkilled", TRUE)
			"####" "#" 0 A_Die
			Stop
		BecomeAlerted:
			"####" "#" 0 A_SetUserVar("user_attacked", 1)
			"####" "#" 0 A_PlaySound("axis1/sighted", CHAN_BODY)
		Pain.BecomeAlerted:
			"####" "#" 0 A_SetUserVar("user_chasegoal", CallACS("GetChaseGoal", user_chasegoal))
			"####" "#" 0 A_ChangeFlag("FRIENDLY", FALSE)
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 0 A_AlertMonsters(512)
			"####" "#" 0 A_SpawnItemEx("SneakableGuardEyesAlerted", 0, 0, 0, 0, 0, 0, 0, SXF_SETMASTER | SXF_NOCHECKPOSITION)
			"####" "#" 0 A_JumpIf(user_attacked > 0, "Super::Pain")
			"####" "#" 0 A_Jump(256, "See")
			Goto See
		Pain.BecomeIdle:
			"####" "#" 0 A_ChangeFlag("FRIENDLY", TRUE)
			"####" "#" 0 A_SetUserVar("user_attacked", 0)
			"####" "#" 0 A_ClearTarget
			"####" "#" 0 ACS_NamedExecute("TryResumePatrolling") 
			Goto Spawn
		Death:
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 0 A_CheckFlag("FRIENDLY", "Super::Death")
			"####" "#" 0 ACS_NamedExecute("DecreaseAlertedCount")
			Goto Super::Death+1
		XDeath:
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 0 A_CheckFlag("FRIENDLY", "Super::XDeath")
			"####" "#" 0 ACS_NamedExecute("DecreaseAlertedCount")
			Goto Super::XDeath
	}
}

ACTOR SneakableMP40Guard : MP40Guard
{
	//$Category Monsters (Wolf3D)/Sneak-Friendly
	//$Title Afrika Korps Guard (MP40, sneak-friendly)
	//$Color 4
	//$Sprite MGRDA1
	PainChance 256
	var int user_chasegoal;
	var int user_stealthkilled;
	var int user_attacked;
	+FRIENDLY
	+NEVERTARGET
	+NOINFIGHTING
	States
	{
		Spawn:
			TNT1 A 0 NoDelay A_SpawnItemEx("SneakableGuardEyesIdle", 0, 0, 0, 0, 0, 0, 0, SXF_SETMASTER | SXF_NOCHECKPOSITION)
			Goto Super::Spawn
		Missile:
			"####" "#" 0 A_AlertMonsters(512)
			Goto Super::Missile
		Pain: 
			"####" "#" 0 A_CheckFlag("FRIENDLY", "BecomeAlerted")
			Goto Super::Pain
		Pain.SilentKnifeAttack:
			"####" "#" 0 A_CheckFlag("FRIENDLY", "StealthKill")
			Goto Super::Pain
		StealthKill:
			"####" "#" 0 A_Log("Stealth kill!")
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 1 A_AlertMonsters(128) 
			"####" "#" 0 ACS_NamedExecuteAlways("AddExtraVisibility", 0, 200, 1)
			"####" "#" 0 A_SetUserVar("user_stealthkilled", TRUE)
			"####" "#" 0 A_Die
			Stop
		BecomeAlerted:
			"####" "#" 0 A_SetUserVar("user_attacked", 1)
			"####" "#" 0 A_PlaySound("axis1/sighted", CHAN_BODY)
		Pain.BecomeAlerted:
			"####" "#" 0 A_SetUserVar("user_chasegoal", CallACS("GetChaseGoal", user_chasegoal))
			"####" "#" 0 A_ChangeFlag("FRIENDLY", FALSE)
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 0 A_AlertMonsters(512)
			"####" "#" 0 A_SpawnItemEx("SneakableGuardEyesAlerted", 0, 0, 0, 0, 0, 0, 0, SXF_SETMASTER | SXF_NOCHECKPOSITION)
			"####" "#" 0 A_JumpIf(user_attacked > 0, "Super::Pain")
			"####" "#" 0 A_Jump(256, "See")
			Goto See
		Pain.BecomeIdle:
			"####" "#" 0 A_ChangeFlag("FRIENDLY", TRUE)
			"####" "#" 0 A_SetUserVar("user_attacked", 0)
			"####" "#" 0 A_ClearTarget
			"####" "#" 0 ACS_NamedExecute("TryResumePatrolling") 
			Goto Spawn
		Death:
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 0 A_CheckFlag("FRIENDLY", "Super::Death")
			"####" "#" 0 ACS_NamedExecute("DecreaseAlertedCount")
			Goto Super::Death+1
		XDeath:
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 0 A_CheckFlag("FRIENDLY", "Super::XDeath")
			"####" "#" 0 ACS_NamedExecute("DecreaseAlertedCount")
			Goto Super::XDeath
	}
}

ACTOR SneakableGuard : Guard
{
	//$Category Monsters (Wolf3D)/Sneak-Friendly
	//$Title Afrika Korps Guard (Pistol, sneak-friendly)
	//$Color 4
	//$Sprite GARDA1
	PainChance 256
	var int user_chasegoal;
	var int user_stealthkilled;
	var int user_attacked;
	+FRIENDLY
	+NEVERTARGET
	+NOINFIGHTING
	States
	{
		Spawn:
			TNT1 A 0 NoDelay A_SpawnItemEx("SneakableGuardEyesIdle", 0, 0, 0, 0, 0, 0, 0, SXF_SETMASTER | SXF_NOCHECKPOSITION)
			Goto Super::Spawn
		Missile:
			"####" "#" 0 A_AlertMonsters(512)
			Goto Super::Missile
		Pain: 
			"####" "#" 0 A_CheckFlag("FRIENDLY", "BecomeAlerted")
			Goto Super::Pain
		Pain.SilentKnifeAttack:
			"####" "#" 0 A_CheckFlag("FRIENDLY", "StealthKill")
			Goto Super::Pain
		StealthKill:
			"####" "#" 0 A_Log("Stealth kill!")
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 1 A_AlertMonsters(128) 
			"####" "#" 0 ACS_NamedExecuteAlways("AddExtraVisibility", 0, 200, 1)
			"####" "#" 0 A_SetUserVar("user_stealthkilled", TRUE)
			"####" "#" 0 A_Die
			Stop
		BecomeAlerted:
			"####" "#" 0 A_SetUserVar("user_attacked", 1)
			"####" "#" 0 A_PlaySound("axis1/sighted", CHAN_BODY)
		Pain.BecomeAlerted:
			"####" "#" 0 A_SetUserVar("user_chasegoal", CallACS("GetChaseGoal", user_chasegoal))
			"####" "#" 0 A_ChangeFlag("FRIENDLY", FALSE)
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 0 A_AlertMonsters(512)
			"####" "#" 0 A_SpawnItemEx("SneakableGuardEyesAlerted", 0, 0, 0, 0, 0, 0, 0, SXF_SETMASTER | SXF_NOCHECKPOSITION)
			"####" "#" 0 A_JumpIf(user_attacked > 0, "Super::Pain")
			"####" "#" 0 A_Jump(256, "See")
			Goto See
		Pain.BecomeIdle:
			"####" "#" 0 A_ChangeFlag("FRIENDLY", TRUE)
			"####" "#" 0 A_SetUserVar("user_attacked", 0)
			"####" "#" 0 A_ClearTarget
			"####" "#" 0 ACS_NamedExecute("TryResumePatrolling") 
			Goto Spawn
		Death:
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 0 A_CheckFlag("FRIENDLY", "Super::Death")
			"####" "#" 0 ACS_NamedExecute("DecreaseAlertedCount")
			Goto Super::Death+1
		XDeath:
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 0 A_CheckFlag("FRIENDLY", "Super::XDeath")
			"####" "#" 0 ACS_NamedExecute("DecreaseAlertedCount")
			Goto Super::XDeath
	}
}

ACTOR SneakableOfficer : Officer
{
	//$Category Monsters (Wolf3D)/Sneak-Friendly
	//$Title Afrika Korps Officer (sneak-friendly)
	//$Color 4
	//$Sprite OFFIA1
	PainChance 256
	var int user_chasegoal;
	var int user_stealthkilled;
	var int user_attacked;
	+FRIENDLY
	+NEVERTARGET
	+NOINFIGHTING
	States
	{
		Spawn:
			TNT1 A 0 NoDelay A_SpawnItemEx("SneakableGuardEyesIdle", 0, 0, 0, 0, 0, 0, 0, SXF_SETMASTER | SXF_NOCHECKPOSITION)
			Goto Super::Spawn
		Missile:
			"####" "#" 0 A_AlertMonsters(512)
			Goto Super::Missile
		Pain: 
			"####" "#" 0 A_CheckFlag("FRIENDLY", "BecomeAlerted")
			Goto Super::Pain
		Pain.SilentKnifeAttack:
			"####" "#" 0 A_CheckFlag("FRIENDLY", "StealthKill")
			Goto Super::Pain
		StealthKill:
			"####" "#" 0 A_Log("Stealth kill!")
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 1 A_AlertMonsters(128) 
			"####" "#" 0 ACS_NamedExecuteAlways("AddExtraVisibility", 0, 200, 1)
			"####" "#" 0 A_SetUserVar("user_stealthkilled", TRUE)
			"####" "#" 0 A_Die
			Stop
		BecomeAlerted:
			"####" "#" 0 A_SetUserVar("user_attacked", 1)
			"####" "#" 0 A_PlaySound("axis1/sighted", CHAN_BODY)
		Pain.BecomeAlerted:
			"####" "#" 0 A_SetUserVar("user_chasegoal", CallACS("GetChaseGoal", user_chasegoal))
			"####" "#" 0 A_ChangeFlag("FRIENDLY", FALSE)
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 0 A_AlertMonsters(512)
			"####" "#" 0 A_SpawnItemEx("SneakableGuardEyesAlerted", 0, 0, 0, 0, 0, 0, 0, SXF_SETMASTER | SXF_NOCHECKPOSITION)
			"####" "#" 0 A_JumpIf(user_attacked > 0, "Super::Pain")
			"####" "#" 0 A_Jump(256, "See")
			Goto See
		Pain.BecomeIdle:
			"####" "#" 0 A_ChangeFlag("FRIENDLY", TRUE)
			"####" "#" 0 A_SetUserVar("user_attacked", 0)
			"####" "#" 0 A_ClearTarget
			"####" "#" 0 ACS_NamedExecute("TryResumePatrolling") 
			Goto Spawn
		Death:
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 0 A_CheckFlag("FRIENDLY", "Super::Death")
			"####" "#" 0 ACS_NamedExecute("DecreaseAlertedCount")
			Goto Super::Death+1
		XDeath:
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 0 A_CheckFlag("FRIENDLY", "Super::XDeath")
			"####" "#" 0 ACS_NamedExecute("DecreaseAlertedCount")
			Goto Super::XDeath
	}
}

ACTOR SneakableWMP40Guard : WMP40Guard
{
	//$Category Monsters (Wolf3D)/Sneak-Friendly
	//$Title Wehrmacht Guard (MP40, sneak-friendly)
	//$Color 4
	//$Sprite MGR2A1
	PainChance 256
	var int user_chasegoal;
	var int user_stealthkilled;
	var int user_attacked;
	+FRIENDLY
	+NEVERTARGET
	+NOINFIGHTING
	States
	{
		Spawn:
			TNT1 A 0 NoDelay A_SpawnItemEx("SneakableGuardEyesIdle", 0, 0, 0, 0, 0, 0, 0, SXF_SETMASTER | SXF_NOCHECKPOSITION)
			Goto Super::Spawn
		Missile:
			"####" "#" 0 A_AlertMonsters(512)
			Goto Super::Missile
		Pain: 
			"####" "#" 0 A_CheckFlag("FRIENDLY", "BecomeAlerted")
			Goto Super::Pain
		Pain.SilentKnifeAttack:
			"####" "#" 0 A_CheckFlag("FRIENDLY", "StealthKill")
			Goto Super::Pain
		StealthKill:
			"####" "#" 0 A_Log("Stealth kill!")
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 1 A_AlertMonsters(128) 
			"####" "#" 0 ACS_NamedExecuteAlways("AddExtraVisibility", 0, 200, 1)
			"####" "#" 0 A_SetUserVar("user_stealthkilled", TRUE)
			"####" "#" 0 A_Die
			Stop
		BecomeAlerted:
			"####" "#" 0 A_SetUserVar("user_attacked", 1)
			"####" "#" 0 A_PlaySound("axis1/sighted", CHAN_BODY)
		Pain.BecomeAlerted:
			"####" "#" 0 A_SetUserVar("user_chasegoal", CallACS("GetChaseGoal", user_chasegoal))
			"####" "#" 0 A_ChangeFlag("FRIENDLY", FALSE)
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 0 A_AlertMonsters(512)
			"####" "#" 0 A_SpawnItemEx("SneakableGuardEyesAlerted", 0, 0, 0, 0, 0, 0, 0, SXF_SETMASTER | SXF_NOCHECKPOSITION)
			"####" "#" 0 A_JumpIf(user_attacked > 0, "Super::Pain")
			"####" "#" 0 A_Jump(256, "See")
			Goto See
		Pain.BecomeIdle:
			"####" "#" 0 A_ChangeFlag("FRIENDLY", TRUE)
			"####" "#" 0 A_SetUserVar("user_attacked", 0)
			"####" "#" 0 A_ClearTarget
			"####" "#" 0 ACS_NamedExecute("TryResumePatrolling") 
			Goto Spawn
		Death:
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 0 A_CheckFlag("FRIENDLY", "Super::Death")
			"####" "#" 0 ACS_NamedExecute("DecreaseAlertedCount")
			Goto Super::Death+1
		XDeath:
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 0 A_CheckFlag("FRIENDLY", "Super::XDeath")
			"####" "#" 0 ACS_NamedExecute("DecreaseAlertedCount")
			Goto Super::XDeath
	}
}

ACTOR SneakableWGuard : WGuard
{
	//$Category Monsters (Wolf3D)/Sneak-Friendly
	//$Title Wehrmacht Guard (Pistol, sneak-friendly)
	//$Color 4
	//$Sprite GRD2A1
	PainChance 256
	var int user_chasegoal;
	var int user_stealthkilled;
	var int user_attacked;
	+FRIENDLY
	+NEVERTARGET
	+NOINFIGHTING
	States
	{
		Spawn:
			TNT1 A 0 NoDelay A_SpawnItemEx("SneakableGuardEyesIdle", 0, 0, 0, 0, 0, 0, 0, SXF_SETMASTER | SXF_NOCHECKPOSITION)
			Goto Super::Spawn
		Missile:
			"####" "#" 0 A_AlertMonsters(512)
			Goto Super::Missile
		Pain: 
			"####" "#" 0 A_CheckFlag("FRIENDLY", "BecomeAlerted")
			Goto Super::Pain
		Pain.SilentKnifeAttack:
			"####" "#" 0 A_CheckFlag("FRIENDLY", "StealthKill")
			Goto Super::Pain
		StealthKill:
			"####" "#" 0 A_Log("Stealth kill!")
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 1 A_AlertMonsters(128) 
			"####" "#" 0 ACS_NamedExecuteAlways("AddExtraVisibility", 0, 200, 1)
			"####" "#" 0 A_SetUserVar("user_stealthkilled", TRUE)
			"####" "#" 0 A_Die
			Stop
		BecomeAlerted:
			"####" "#" 0 A_SetUserVar("user_attacked", 1)
			"####" "#" 0 A_PlaySound("axis1/sighted", CHAN_BODY)
		Pain.BecomeAlerted:
			"####" "#" 0 A_SetUserVar("user_chasegoal", CallACS("GetChaseGoal", user_chasegoal))
			"####" "#" 0 A_ChangeFlag("FRIENDLY", FALSE)
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 0 A_AlertMonsters(512)
			"####" "#" 0 A_SpawnItemEx("SneakableGuardEyesAlerted", 0, 0, 0, 0, 0, 0, 0, SXF_SETMASTER | SXF_NOCHECKPOSITION)
			"####" "#" 0 A_JumpIf(user_attacked > 0, "Super::Pain")
			"####" "#" 0 A_Jump(256, "See")
			Goto See
		Pain.BecomeIdle:
			"####" "#" 0 A_ChangeFlag("FRIENDLY", TRUE)
			"####" "#" 0 A_SetUserVar("user_attacked", 0)
			"####" "#" 0 A_ClearTarget
			"####" "#" 0 ACS_NamedExecute("TryResumePatrolling") 
			Goto Spawn
		Death:
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 0 A_CheckFlag("FRIENDLY", "Super::Death")
			"####" "#" 0 ACS_NamedExecute("DecreaseAlertedCount")
			Goto Super::Death+1
		XDeath:
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 0 A_CheckFlag("FRIENDLY", "Super::XDeath")
			"####" "#" 0 ACS_NamedExecute("DecreaseAlertedCount")
			Goto Super::XDeath
	}
}

ACTOR SneakableWOfficer : WOfficer
{
	//$Category Monsters (Wolf3D)/Sneak-Friendly
	//$Title Wehrmacht Officer (sneak-friendly)
	//$Color 4
	//$Sprite OFR2A1
	PainChance 256
	var int user_chasegoal;
	var int user_stealthkilled;
	var int user_attacked;
	+FRIENDLY
	+NEVERTARGET
	+NOINFIGHTING
	States
	{
		Spawn:
			TNT1 A 0 NoDelay A_SpawnItemEx("SneakableGuardEyesIdle", 0, 0, 0, 0, 0, 0, 0, SXF_SETMASTER | SXF_NOCHECKPOSITION)
			Goto Super::Spawn
		Missile:
			"####" "#" 0 A_AlertMonsters(512)
			Goto Super::Missile
		Pain: 
			"####" "#" 0 A_CheckFlag("FRIENDLY", "BecomeAlerted")
			Goto Super::Pain
		Pain.SilentKnifeAttack:
			"####" "#" 0 A_CheckFlag("FRIENDLY", "StealthKill")
			Goto Super::Pain
		StealthKill:
			"####" "#" 0 A_Log("Stealth kill!")
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 1 A_AlertMonsters(128) 
			"####" "#" 0 ACS_NamedExecuteAlways("AddExtraVisibility", 0, 200, 1)
			"####" "#" 0 A_SetUserVar("user_stealthkilled", TRUE)
			"####" "#" 0 A_Die
			Stop
		BecomeAlerted:
			"####" "#" 0 A_SetUserVar("user_attacked", 1)
			"####" "#" 0 A_PlaySound("axis1/sighted", CHAN_BODY)
		Pain.BecomeAlerted:
			"####" "#" 0 A_SetUserVar("user_chasegoal", CallACS("GetChaseGoal", user_chasegoal))
			"####" "#" 0 A_ChangeFlag("FRIENDLY", FALSE)
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 0 A_AlertMonsters(512)
			"####" "#" 0 A_SpawnItemEx("SneakableGuardEyesAlerted", 0, 0, 0, 0, 0, 0, 0, SXF_SETMASTER | SXF_NOCHECKPOSITION)
			"####" "#" 0 A_JumpIf(user_attacked > 0, "Super::Pain")
			"####" "#" 0 A_Jump(256, "See")
			Goto See
		Pain.BecomeIdle:
			"####" "#" 0 A_ChangeFlag("FRIENDLY", TRUE)
			"####" "#" 0 A_SetUserVar("user_attacked", 0)
			"####" "#" 0 A_ClearTarget
			"####" "#" 0 ACS_NamedExecute("TryResumePatrolling") 
			Goto Spawn
		Death:
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 0 A_CheckFlag("FRIENDLY", "Super::Death")
			"####" "#" 0 ACS_NamedExecute("DecreaseAlertedCount")
			Goto Super::Death+1
		XDeath:
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 0 A_CheckFlag("FRIENDLY", "Super::XDeath")
			"####" "#" 0 ACS_NamedExecute("DecreaseAlertedCount")
			Goto Super::XDeath
	}
}

ACTOR SneakableGestapo : Gestapo
{
	//$Category Monsters (Wolf3D)/Sneak-Friendly
	//$Title Gestapo Officer (sneak-friendly)
	//$Color 4
	//$Sprite GSAPN1
	PainChance 256
	var int user_chasegoal;
	var int user_stealthkilled;
	var int user_attacked;
	+FRIENDLY
	+NEVERTARGET
	+NOINFIGHTING

	Nazi.PerceptionTime 140 // About 4 seconds
	Nazi.PerceptionFOV 120 // Relatively wide view

	States
	{
		Spawn:
			TNT1 A 0 NoDelay A_SpawnItemEx("SneakableGuardEyesIdle", 0, 0, 0, 0, 0, 0, 0, SXF_SETMASTER | SXF_NOCHECKPOSITION)
			Goto Super::Spawn
		Missile:
			"####" "#" 0 A_AlertMonsters(512)
			Goto Super::Missile
		Pain: 
			"####" "#" 0 A_CheckFlag("FRIENDLY", "BecomeAlerted")
			Goto Super::Pain
		Pain.SilentKnifeAttack:
			"####" "#" 0 A_CheckFlag("FRIENDLY", "StealthKill")
			Goto Super::Pain
		StealthKill:
			"####" "#" 0 A_Log("Stealth kill!")
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 1 A_AlertMonsters(128) 
			"####" "#" 0 ACS_NamedExecuteAlways("AddExtraVisibility", 0, 200, 1)
			"####" "#" 0 A_SetUserVar("user_stealthkilled", TRUE)
			"####" "#" 0 A_Die
			Stop
		BecomeAlerted:
			"####" "#" 0 A_SetUserVar("user_attacked", 1)
			"####" "#" 0 A_PlaySound("axis1/sighted", CHAN_BODY)
		Pain.BecomeAlerted:
			"####" "#" 0 A_SetUserVar("user_chasegoal", CallACS("GetChaseGoal", user_chasegoal))
			"####" "#" 0 A_ChangeFlag("FRIENDLY", FALSE)
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 0 A_AlertMonsters(512)
			"####" "#" 0 A_SpawnItemEx("SneakableGuardEyesAlerted", 0, 0, 0, 0, 0, 0, 0, SXF_SETMASTER | SXF_NOCHECKPOSITION)
			"####" "#" 0 A_JumpIf(user_attacked > 0, "Super::Pain")
			"####" "#" 0 A_Jump(256, "See")
			Goto See
		Pain.BecomeIdle:
			"####" "#" 0 A_ChangeFlag("FRIENDLY", TRUE)
			"####" "#" 0 A_SetUserVar("user_attacked", 0)
			"####" "#" 0 A_ClearTarget
			"####" "#" 0 ACS_NamedExecute("TryResumePatrolling") 
			Goto Spawn
		Death:
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 0 A_CheckFlag("FRIENDLY", "Super::Death")
			"####" "#" 0 ACS_NamedExecute("DecreaseAlertedCount")
			Goto Super::Death+1
		XDeath:
			"####" "#" 0 A_RemoveChildren(TRUE, RMVF_EVERYTHING)
			"####" "#" 0 A_CheckFlag("FRIENDLY", "Super::XDeath")
			"####" "#" 0 ACS_NamedExecute("DecreaseAlertedCount")
			Goto Super::XDeath
	}
}