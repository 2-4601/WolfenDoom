class LanternPickup : CustomInventory
{
	bool active;

	Default
	{
		//$Category Powerups (Wolf3D)
		//$Title Useable Lantern (requires Oil)
		//$Color 6
		Scale 0.5;
		Tag "$TAGLANTR";
		Inventory.Icon "LANTB0";
		Inventory.PickupMessage "$LANTERN";
		Inventory.MaxAmount 1;
		Inventory.PickupSound "misc/gadget_pickup";
		+INVENTORY.INVBAR
		+INVENTORY.UNDROPPABLE
	}

	States
	{
		Spawn:
			LANT A -1;
			Stop;
		Pickup:
			"####" A 0 A_GiveInventory("LanternOil", 1000);
			Stop;
		Use:
			"####" A 0 {
				invoker.active = !invoker.active;

				if (invoker.active && !FindInventory("LanternOil")) { invoker.active = false; }
			}
			Fail;
	}

	override void Tick()
	{
		if (globalfreeze || level.Frozen) { return; }

		if (owner && active)
		{
			if (owner.waterlevel >= 3)
			{
				A_PlaySound("flamer/steam", CHAN_AUTO, Random(15, 45));
				active = false;
			}
			else if (owner.FindInventory("LanternOil")) { owner.TakeInventory("LanternOil", 1); }
			else { active = false; }
		}
	}
}

class MineSweeper : CustomInventory
{
	bool active;

	Default
	{
		//$Category Powerups (Wolf3D)
		//$Title Human Mine Scanning (pickups)
		//$Color 6
		Scale 0.5;
		Tag "$TAGSWEEP";
		Inventory.Icon "MSPUB0";
		Inventory.PickupMessage "$SWEEPER";
		Inventory.MaxAmount 1;
		+INVENTORY.INVBAR
		+INVENTORY.UNDROPPABLE
	}

	States
	{
		Spawn:
			MSPU A -1;
			Stop;
		Pickup:
			"####" A 0 {
				if (CountInv("MineSweeper") == 0) {
					A_GiveInventory ("Power", 2400);
					return true;
				} else if (CountInv("MineSweeper") > 0 && CountInv("Power") < 2400) {
					A_GiveInventory ("Power", 2400 - CountInv("Power"));
					A_TakeInventory ("MineSweeper", 1); // The player will immediately get another minesweeper.
					return true;
				} else {
					return false;
				}
			}
			Stop;
		Use:
			"####" A 0 {
				invoker.active = !invoker.active;

				if (invoker.active && !FindInventory("Power")) { invoker.active = false; }
			}
			Fail;
	}

	override void Tick()
	{
		if (globalfreeze || level.Frozen || !owner || !owner.player) { return; }

		if (owner && active)
		{
			if (owner.FindInventory("Power")) { owner.TakeInventory("Power", 1); }
			else { active = false; }
		}
	}
}

class BoACompass : CustomInventory
{
	bool active;

	Default
	{
		//$Category Pickups (Wolf3D)
		//$Title Compass
		//$Color 13
		Scale 0.2;
		Tag "$TAGCOMPS";
		Inventory.Icon "CMPSB0";
		Inventory.PickupMessage "$COMPASS";
		Inventory.PickupSound "misc/armor_head";
		Inventory.MaxAmount 1;
		+INVENTORY.INVBAR
	}

	States
	{
		Spawn:
			CMPS A -1;
			Stop;
		Use:
			TNT1 A 0 {
				invoker.active = !invoker.active;
			}
			Fail;
	}

	override Inventory CreateTossable(int amt)
	{
		active = false;
		return Super.CreateTossable(amt);
	}

	static void Add(Actor toAdd)
	{
		// Console.Printf("Attempting to add a %s to the compass.", toAdd.GetClassName());
		CompassHandler compassEvent = CompassHandler(StaticEventHandler.Find("CompassHandler"));
		compassEvent.ScannableThings.Push(toAdd);
	}
}