// Used for rendering space suit and gas mask HUD graphics below the HUD
class UnderlayRenderer : EventHandler
{
    TextureID SpaceSuitGraphic;
    TextureID GasMaskGraphic;

    override void OnRegister()
    {
        SpaceSuitGraphic = TexMan.CheckForTexture("STGMASK", TexMan.Type_Any); // TODO: Replace with proper space suit mask graphic
        GasMaskGraphic = TexMan.CheckForTexture("STGZASK", TexMan.Type_Any);
    }

    override void RenderUnderlay(RenderEvent e)
    {
        PlayerInfo p = players[consoleplayer];
        if ((p.cheats & CF_CHASECAM) == 0)
        {
            int vWidth = int(200 * Screen.GetAspectRatio());
            int vXOffset = 320 - vWidth / 2;
            Inventory SpaceSuit = p.mo.FindInventory("PowerSpaceSuit");
            int lightlevel = p.mo.CurSector.lightlevel;
            //double maskAlpha = lightlevel <= 64 ? lightlevel / 64.0 : 1.0; // Experiment
            double maskAlpha = 1.0;
            //double blackAlpha = lightlevel > 64 ? 1.0 - (lightlevel - 64.0) / 192.0 : 1.0; // Experiment
            double blackAlpha = 1.0 - (lightlevel / 255.0);
            if (SpaceSuit)
            {
                Screen.DrawTexture(SpaceSuitGraphic, false, 0.0, 0.0, DTA_TopOffset, 80, DTA_LeftOffset, vXOffset, DTA_VirtualHeight, 200, DTA_VirtualWidth, vWidth, DTA_KeepRatio, true, DTA_Alpha, maskAlpha);
                // Darken in dark sectors
                Screen.DrawTexture(SpaceSuitGraphic, false, 0.0, 0.0, DTA_TopOffset, 80, DTA_LeftOffset, vXOffset, DTA_VirtualHeight, 200, DTA_VirtualWidth, vWidth, DTA_KeepRatio, true, DTA_FillColor, 0, DTA_Alpha, blackAlpha);
            }
            Inventory ZyklonGasMask = p.mo.FindInventory("PowerZyklonMask");
            if (ZyklonGasMask)
            {
                Screen.DrawTexture(GasMaskGraphic, false, 0.0, 0.0, DTA_TopOffset, 80, DTA_LeftOffset, vXOffset, DTA_VirtualHeight, 200, DTA_VirtualWidth, vWidth, DTA_KeepRatio, true, DTA_Alpha, maskAlpha);
                // Darken in dark sectors
                Screen.DrawTexture(GasMaskGraphic, false, 0.0, 0.0, DTA_TopOffset, 80, DTA_LeftOffset, vXOffset, DTA_VirtualHeight, 200, DTA_VirtualWidth, vWidth, DTA_KeepRatio, true, DTA_FillColor, 0, DTA_Alpha, blackAlpha);
            }
        }
    }
}